# Provided Data

All provided data for this workflow is located in the ALTER-code/5_tutorial-workflows/2_MARIA_Pipeline directory, where this file should also be located:
|Data|Description|
|:--:|:----------|
|ALTER4_Maria_Input.txt|Example ALTER4 input file for MARIA analysis as generated by the provided workflow|
|ALTER4_Maria_Input.txt.output.txt|Example MARIA output file of above input file|
|Example De-Immunization Workflow.Rmd|R notebook explaining how to utilize the code provided to de-immunize a given protein sequence| 
|MARIA_Input_Template.txt|An empty MARIA Template used for generating MARIA input jobs|

# Data not provided

The files ALTER4_Mutant_Peptides.tsv and ALTER4_Mutant_Peptides_MARIA_input.txt will be generated by running the pipeline but are too large to feasibly upload to this repository.

# Running Deimunization Pipeline

## 1. Generate Initial MARIA Input File

Source "De-Immunization Scripts.R" provided in the ALTER-code/6_MARIA_Deimmunization directory before attempting to run any tutorial notebook code.

Follow the example notebook to generate an initial MARIA input file for either the provided or your given sequence of interest.

## 2. Process Initial MARIA Input

This tutorial will require a local copy of the MARIA prediction algorithm, accessible at "https://maria.stanford.edu/".
Ensure your local copy is generating the expected results by running the test input jobs accompanying download.

Process your intial MARIA input ("ALTER4_Maria_Input.txt" in our example) with a 63rd percentile cutoff threshold to generate a MARIA output file ("ALTER4_Maria_Input.txt.output.txt")

## 3. Load MARIA Prediction Into Environment and Generate Mutant Varients
Following the tutorial, proceed to:

1. Identify non-native peptides predicted for MCH II presentation. 
2. Generate new varient list with all possible mutations to silence presented regions.
3. Write new varient list as a MARIA input file

## 4. Predict Presentation of Varient Peptides

If running locally MARIA locally, it is highly advised to use "split_MARIA_input.py" found in the ALTER-code/6_MARIA_Deimmunization directory 
to reduced the size of each job submitted to MARIA for prediction.

1. Call split_MARIA_input.py via command line with the following arguments: input_filename, output_prefix, max_samples_per_chunk
     ex: python split_MARIA_input.py ALTER4_Mutant_Peptides_MARIA_Input.txt ALTER4_MV1 --max_samples_per_chunk 100000
2. Call run_MARIA_batch.py via command line with the following arguments: split_folder, output_prefix, cutoff
     ex: pyton run_MARIA_batch.py --split_folder split_ALTER4_MV1 --output_prefix ALTER4_MV1 --cutoff 63
3. Load and recombine chunked outputs into R environment as shown.

## 5. Filter for Most Effective Mutations

Following the tutorial, filter the MARIA varient output to determine the mutations ablating the most non-native peptides predicted to be presented. 
As each iteration of the workflow only introduces up to two mutants per presented non-native sequence, the pipeline can be re-reun with a given output to further reduced predicted non-native peptide presentation.

